C51 COMPILER V9.59.0.0   INIT                                                              05/08/2020 12:19:53 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE INIT
OBJECT MODULE PLACED IN .\Objects\Init.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\Basic\init\Init.c OBJECTADVANCED OPTIMIZE(9,SPEED) BROWSE MODP2 INC
                    -DIR(.\Code\Basic\def;.\Code\Basic\delay;.\Code\Basic\init;.\Code\Basic\uart;.\Code\Basic\EEPROM;.\Code\AlibabaCloud;.\Co
                    -de\SubDev\DS18B20;.\Code\SubDev\GY_25;.\Code\SubDev\LCD1602;.\Code\SubDev\LED) DEBUG PRINT(.\Listings\Init.lst) OBJECT(.
                    -\Objects\Init.obj)

line level    source

   1          #include "Init.h"
   2          //------------------------------------------------------------------------------------------------//
   3          static void Init_rst(void);
   4          static void Init_io(void);
   5          static void Init_timer0(void);
   6          static void Init_uart1(void);
   7          static void Init_uart2(void);
   8          static void Init_uart4(void);
   9          static void Init_wkt(float,bool);
  10          static void Init_interrupt(void);
  11          //------------------------------------------------------------------------------------------------//
  12          
  13          void Init(void)
  14          {
  15   1          //ÄÚ²¿
  16   1          Init_rst();       //µÍÑ¹¸´Î»&¿´ÃÅ¹·³õÊ¼»¯
  17   1          Init_io();        //IO¿Ú³õÊ¼»¯
  18   1          Init_timer0();    //¶¨Ê±Æ÷0³õÊ¼»¯
  19   1      #if LOGRANK_UART1 >= 1
                  Init_uart1();     //´®¿Ú1-USBµ÷ÊÔ³õÊ¼»¯
              #endif
  22   1          Init_uart2();     //´®¿Ú2-Wifi*EMW3080³õÊ¼»¯
  23   1              Init_uart4();     //´®¿Ú4-·½Î»½Ç´«¸ÐÆ÷GY-25³õÊ¼»¯
  24   1              Init_wkt(1.0,false);//ÉèÖÃµôµç»½ÐÑ¼ÆÊ±Æ÷,µ¥Î»ms.ÔÊÐí0.5ms-min(0),16384ms-max(32767);Ã¿´ÎÔö³¤0.5ms
  25   1          Init_interrupt(); //ÖÐ¶ÏÏµÍ³³õÊ¼»¯-¿ª¹Ø ÓÅÏÈ¼¶
  26   1      #if LOGRANK_UART1 >= 2
                  printf("LOG#:Internal Init Finish\r\n");
              #endif
  29   1          //Íâ²¿
  30   1              CloudInit();
  31   1          DS18B20STInit(); //³õÊ¼»¯DS18B20ÄÚ´æ&¶ÁÈ¡µ±Ç°DS18B20·Ö±æÂÊ
  32   1              GY_25Init();    //³õÊ¼»¯GY_25
  33   1              LEDInit();              //³õÊ¼»¯LED
  34   1              LCD1602Init();    ////³õÊ¼»¯LCD1602
  35   1      #if LOGRANK_UART1 >= 2
                  printf("LOG#:External Init Finish\r\n");
              #endif
  38   1      }
  39          void Init_rst(void)
  40          {
  41   1          //¿´ÃÅ¹·¼Ä´æÆ÷ // WDT_FLAG - EN_WDT CLR_WDT IDL_WDT WDT_PS[2:0]
  42   1          WDT_CONTR = WDT_CONTR & ~EN_WDT;//¿ª¹Ø¿´ÃÅ¹·
  43   1              //WDT_CONTR |= 0x07;//¿´ÃÅ¹··ÖÆµÏµÊý×î´ó
  44   1          //µÍÑ¹¸´Î»/RSTÒý½Å ÅäÖÃ¼Ä´æÆ÷ // - ENLVR - P54RST - - LVDS[1:0]
  45   1          RSTCFG = RSTCFG & ~0x40 & ~0x10;
  46   1          RSTCFG &= 0xFC; //LVDS[1:0] µÍÑ¹¼ì²âÃÅ¼÷µçÑ¹:00 2.2V/01 2.4V/10 2.7V/11 3.0V
  47   1      }
  48          void Init_io(void)
  49          {
  50   1              //´®¿Ú1
  51   1          P3M1 &= ~0x01, P3M0 &= ~0x01; //P3.0Îª×¼Ë«Ïò¿Ú
  52   1          P3M1 &= ~0x02, P3M0 |= 0x02; //P3.1ÎªÍÆÍìÊä³ö
C51 COMPILER V9.59.0.0   INIT                                                              05/08/2020 12:19:53 PAGE 2   

  53   1              //´®¿Ú2
  54   1          P1M1 &= ~0x01, P1M0 &= ~0x01; //P1.0Îª×¼Ë«Ïò¿Ú
  55   1          P1M1 &= ~0x02, P1M0 |= 0x02; //P1.1ÎªÍÆÍìÊä³ö
  56   1              //´®¿Ú4
  57   1          P0M1 &= ~0x04, P0M0 &= ~0x04; //P0.2Îª×¼Ë«Ïò¿Ú
  58   1          P0M1 &= ~0x08, P0M0 |= 0x08; //P0.3ÎªÍÆÍìÊä³ö
  59   1      }
  60          void Init_timer0(void)//1ms
  61          {
  62   1              AUXR |= 0x80;           //¶¨Ê±Æ÷Ê±ÖÓ1TÄ£Ê½
  63   1              TMOD &= 0xF0;           //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
  64   1              TL0 = 0x9A;             //ÉèÖÃ¶¨Ê±³õÖµ
  65   1              TH0 = 0xA9;             //ÉèÖÃ¶¨Ê±³õÖµ
  66   1              TF0 = 0;                //Çå³ýTF0±êÖ¾
  67   1              TR0 = 1;                //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
  68   1      }
  69          #if LOGRANK_UART1 >= 1
              void Init_uart1(void)
              {
                      //Óë´®¿Ú2¹²ÓÃ¶¨Ê±Æ÷2
                  SCON = 0x40;                 // SM0/FE [SM1] SM2 REN TB8 RB8 TI RI
                  PCON &= 0x3F;                // [~SMOD ~SMOD0] LVDF POF GF1 GF0 PD IDL //²¨ÌØÂÊ²»·­±¶£¬²»²ÉÓÃÖ¡´íÎó¼ì²
             -â
                  AUXR |= S1ST2; // T0x12 T1x12 UART_M0x6 T2R T2_C/T T2x12 EXTRAM [S1ST2]//Ñ¡ÓÃ¶¨Ê±Æ÷2
                      
                  uart1Busy = false;
              }
              #endif
  80          void Init_uart2(void)
  81          {
  82   1              //¶¨Ê±Æ÷2
  83   1              ulong BTL = UART_16(115200, 1);
  84   1              AUXR |= T2x12;//T2ËÙ¶Èx12
  85   1              T2L = BTL & 0xFF;
  86   1          T2H = BTL >> 8;
  87   1              
  88   1          S2CON = 0x10;   // [~S4SM0] [/] S4SM2 [S4REN] S4TB8 S4RB8 S4TI S4RI
  89   1              
  90   1          uart2Busy = false;
  91   1          uart2Idx1 = uart2Idx2 = 0;
  92   1          AUXR |= T2R; //¿ªÆô¶¨Ê±Æ÷2
  93   1      }
  94          void Init_uart4(void)
  95          {
  96   1              //¶¨Ê±Æ÷4
  97   1              ulong BTL = UART_16(9600,1);
  98   1              T4T3M |= T4x12;//T4ËÙ¶Èx12
  99   1              T4L = BTL & 0xFF;
 100   1          T4H = BTL >> 8;
 101   1              
 102   1              S4CON = 0x50;
 103   1              
 104   1          uart4Busy = false;
 105   1          uart4Idx1 = uart4Idx2 = 0;
 106   1              T4T3M |= T4R;//¿ªÆô¶¨Ê±Æ÷4
 107   1      }
 108          void Init_wkt(float ms,bool en)//ÉèÖÃµôµç»½ÐÑ¼ÆÊ±Æ÷,µ¥Î»ms.ÔÊÐí0.5ms-min(0),16384ms-max(32767);Ã¿´ÎÔö³¤0.5
             -ms
 109          {
 110   1              pdata ushort T;
 111   1              if(en==false)
 112   1                      return;
C51 COMPILER V9.59.0.0   INIT                                                              05/08/2020 12:19:53 PAGE 3   

 113   1              T = ((ms*2.0)-1);
 114   1              T &= 0x7FFF;
 115   1              WKTCL = T&0x00FF;
 116   1              WKTCH = (T>>8)&0x007F;
 117   1              WKTCH |= 0x80;//¿ªÆôµôµç»½ÐÑ¼ÆÊ±Æ÷
 118   1      }
 119          void Init_interrupt(void)
 120          {
 121   1          ET0 = 1;                    //¿ªÆô¶¨Ê±Æ÷0ÖÐ¶Ï
 122   1          ES = 1;                                     //¿ªÆô´®¿Ú1ÖÐ¶Ï
 123   1          IE2 |= ES2, IE2 &= ~ET2;    //¿ªÆô´®¿Ú2ÖÐ¶Ï,¹Ø±Õ¶¨Ê±Æ÷2ÖÐ¶Ï
 124   1          /*IE2 |= ES4, */IE2 &= ~ET4;        //¿ªÆô´®¿Ú4ÖÐ¶Ï,¹Ø±Õ¶¨Ê±Æ÷4ÖÐ¶Ï
 125   1              
 126   1          PT0 = 0, IPH |= PT0H; //¶¨Ê±Æ÷0ÓÅÏÈ¼¶2,ÏµÍ³Ê±¼ä¾¡¿ÉÄÜ¾«È·,×î¸ßÓÅÏÈ¼¶
 127   1          PS = 0, IPH &= ~PSH;  //´®¿Ú1ÓÅÏÈ¼¶0
 128   1              IP2 |= PS2, IP2H |= PS2H;//´®¿Ú2ÓÅÏÈ¼¶3
 129   1      
 130   1          EA = 1; //¿ªÆô×ÜÖÐ¶Ï¿ª¹Ø
 131   1      }
 132          
 133          //------------------------------------------------------------------------------------------------//


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    315    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       2
   DATA SIZE        =   ----      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
